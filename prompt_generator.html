<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise QA Prompt Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary: #4f46e5;
            --primary-dark: #3730a3;
            --accent: #06b6d4;
            --success: #10b981;
        }

        * {
            font-family: 'Cairo', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #e0e7ff 0%, #f0f2f7 40%, #ecfdf5 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            padding: 20px;
        }

        .main-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.12);
            width: 100%;
            max-width: 1000px;
            display: flex;
            flex-direction: column;
            max-height: 95vh;
            margin: 0 auto;
        }

        .header-section {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 28px 32px;
            border-radius: 16px 16px 0 0;
            flex-shrink: 0;
        }

        .header-section h1 {
            font-size: 1.5rem;
            font-weight: 800;
            margin: 0;
            letter-spacing: 0.5px;
        }

        .header-section p {
            font-size: 0.9rem;
            opacity: 0.85;
            margin: 4px 0 0 0;
        }

        .content-section {
            flex: 1;
            overflow-y: auto;
            padding: 24px 32px;
        }

        .nav-tabs {
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: 24px;
        }

        .nav-link {
            color: #64748b;
            border: none;
            font-weight: 600;
            padding: 12px 20px;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            color: var(--primary);
            border-bottom-color: var(--accent);
        }

        .nav-link.active {
            color: var(--primary);
            background: none !important;
            border-bottom-color: var(--primary);
        }

        .form-label {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .form-control,
        .form-select {
            border: 1.5px solid #e2e8f0;
            border-radius: 8px;
            padding: 10px 14px;
            font-size: 0.95rem;
            transition: all 0.2s ease;
        }

        .form-control:focus,
        .form-select:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 0.2rem rgba(6, 182, 212, 0.25);
        }

        .btn-generate {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border: none;
            color: white;
            font-weight: 700;
            padding: 12px 28px;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .btn-generate:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(79, 70, 229, 0.3);
            color: white;
        }

        .btn-copy {
            background: var(--success);
            border: none;
            color: white;
            font-weight: 700;
            padding: 10px 20px;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .btn-copy:hover {
            background: #059669;
            transform: translateY(-1px);
            color: white;
        }

        .btn-copy.copied {
            background: #0f766e;
        }

        .tech-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: linear-gradient(135deg, var(--accent), #0891b2);
            color: white;
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-right: 8px;
            margin-bottom: 8px;
        }

        .tech-badge svg {
            width: 16px;
            height: 16px;
        }

        .title-chip {
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
            padding: 12px 14px;
            border-radius: 8px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }

        .title-chip:hover {
            background: #ecf0f9;
            border-color: var(--accent);
        }

        .chip-copy-btn {
            background: none;
            border: none;
            color: var(--accent);
            cursor: pointer;
            padding: 4px;
            display: flex;
            align-items: center;
            transition: all 0.2s ease;
        }

        .chip-copy-btn:hover {
            color: var(--primary);
        }

        .chip-copied {
            display: none;
            font-size: 0.8rem;
            color: var(--success);
            font-weight: 700;
        }

        .chip-copied.show {
            display: inline;
        }

        .output-modal .modal-content {
            border-radius: 12px;
            border: none;
        }

        .output-modal .modal-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 12px 12px 0 0;
        }

        .output-modal .modal-title {
            font-weight: 700;
            font-size: 1.2rem;
        }

        .output-modal .btn-close {
            filter: brightness(0) invert(1);
        }

        #output-textarea,
        #bug-output-textarea {
            border: 1.5px solid #e2e8f0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            min-height: 250px;
            height: 320px;
            background: #f8fafc;
            color: #1e293b;
            resize: none;
            width: 100%;
        }

        #output-textarea:focus,
        #bug-output-textarea:focus {
            border-color: var(--accent);
            background: white;
        }

        .copy-feedback {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--success);
            color: white;
            padding: 14px 24px;
            border-radius: 8px;
            font-weight: 700;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 9999;
        }

        .copy-feedback.visible {
            opacity: 1;
        }

        .form-section {
            margin-bottom: 24px;
        }

        #bugs-panel .row {
            display: flex;
            justify-content: center;
        }

        #bugs-panel .col-12 {
            max-width: 100%;
        }

        #bugs-panel .form-section {
            width: 100%;
            max-width: 720px;
            margin-left: auto;
            margin-right: auto;
            padding: 0 20px;
        }

        #bugs-panel .form-section h6 {
            text-align: center;
            margin-bottom: 28px;
            font-size: 1.1rem;
        }

        #bugs-panel .form-control,
        #bugs-panel .form-select {
            background: #f8fafc;
            border: 1.5px solid #e2e8f0;
        }

        #bugs-panel .form-control:focus,
        #bugs-panel .form-select:focus {
            background: white;
            border-color: var(--accent);
            box-shadow: 0 0 0 0.2rem rgba(6, 182, 212, 0.15);
        }

        #bugs-panel .btn-generate {
            width: 100%;
            margin-top: 12px;
        }

        #bugs-panel .form-section {
            width: 100%;
            max-width: 720px;
            margin-left: auto;
            margin-right: auto;
            padding: 0 20px;
        }

        #bugs-panel .form-section h6 {
            text-align: center;
            margin-bottom: 28px;
            font-size: 1.1rem;
        }

        #bugs-panel .form-control,
        #bugs-panel .form-select {
            background: #f8fafc;
            border: 1.5px solid #e2e8f0;
        }

        #bugs-panel .form-control:focus,
        #bugs-panel .form-select:focus {
            background: white;
            border-color: var(--accent);
            box-shadow: 0 0 0 0.2rem rgba(6, 182, 212, 0.15);
        }

        #bugs-panel .col-12 {
            max-width: 100%;
        }

        #bugs-panel .btn-generate {
            width: 100%;
            margin-top: 12px;
        }

        #bug-output-section {
            width: 100%;
            max-width: 720px;
            margin-left: auto;
            margin-right: auto;
            padding: 0 20px;
        }

        #bug-output-section h6 {
            text-align: center;
            margin-bottom: 20px;
        }

        #bug-output-section .mb-3 {
            margin-bottom: 20px;
        }

        #bug-output-section .btn {
            margin-right: 10px;
        }

        /* max-width: 720px;
        margin-left: auto;
        margin-right: auto;
        padding: 0 20px;
        } */

        #bug-output-section h6 {
            text-align: center;
            margin-bottom: 20px;
        }

        #bug-output-section .mb-3 {
            margin-bottom: 20px;
        }

        #bug-output-section .btn {
            width: 48%;
            display: inline-block;
        }

        #bug-output-section .btn-copy {
            margin-right: 4%;
        }

        .form-section h6 {
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 16px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .test-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
            margin-bottom: 24px;
        }

        .category-badge {
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 600;
            text-align: center;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        .category-badge:hover {
            border-color: var(--primary);
            background: #f0f3ff;
        }

        .category-badge.selected {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-color: var(--primary);
        }

        .titles-container {
            background: #f8fafc;
            padding: 16px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .hidden-section {
            display: none;
        }

        .hidden-section.show {
            display: block;
        }

        @media (max-width: 768px) {
            .main-container {
                max-height: 100vh;
            }

            .content-section {
                padding: 16px;
            }

            .header-section {
                padding: 20px 16px;
            }

            .header-section h1 {
                font-size: 1.25rem;
            }

            .nav-link {
                padding: 10px 14px;
                font-size: 0.9rem;
            }
        }

        .tab-content {
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }
    </style>
</head>

<body>
    <div class="main-container">
        <div class="header-section">
            <h1><i class="bi bi-lightning-charge"></i> Enterprise QA Prompt Generator</h1>
            <p>Generate enterprise-grade QA prompts for test scenarios and bug reports</p>
        </div>

        <div class="content-section">
            <ul class="nav nav-tabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="test-tab" data-bs-toggle="tab" data-bs-target="#test-panel"
                        type="button" role="tab">
                        <i class="bi bi-clipboard2-check"></i> Test Scenarios
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="bugs-tab" data-bs-toggle="tab" data-bs-target="#bugs-panel"
                        type="button" role="tab">
                        <i class="bi bi-bug"></i> Bugs Enhancement
                    </button>
                </li>
            </ul>

            <div class="tab-content">
                <!-- Test Scenarios Tab -->
                <div class="tab-pane fade show active" id="test-panel" role="tabpanel">
                    <div class="form-section">
                        <h6><i class="bi bi-file-text"></i> Test Configuration</h6>

                        <div class="row">
                            <div class="col-md-3 mb-4">
                                <label for="platform" class="form-label">Target Platform</label>
                                <select id="platform" class="form-select" onchange="updateTechStack()">
                                    <option value="">Select Platform...</option>
                                    <option value="Desktop">Desktop</option>
                                    <option value="Web" selected>Web</option>
                                    <option value="Mobile">Mobile</option>
                                    <option value="APIs">APIs</option>
                                </select>
                            </div>

                            <div class="col-md-9 mb-4">
                                <label for="tech-stack" class="form-label">Technology Stack</label>
                                <select id="tech-stack" class="form-select" onchange="updateTechBadges()">
                                    <option value="">Select Technology...</option>
                                </select>
                            </div>

                            <div class="col-md-3 mb-4">
                                <label for="test-count" class="form-label">Minimum Test Cases Per Section</label>
                                <input type="number" id="test-count" class="form-control" placeholder="e.g., 15"
                                    value="15">
                            </div>

                            <div class="col-md-9 mb-4">
                                <label for="story-title" class="form-label">Story Title</label>
                                <input type="text" id="story-title" class="form-control"
                                    placeholder="e.g., US-123: Dashboard Analytics">
                            </div>

                            <div class="col-12 mb-4">
                                <label for="story-desc" class="form-label">Story Description</label>
                                <textarea id="story-desc" class="form-control" rows="3"
                                    placeholder="Describe the feature..."></textarea>
                            </div>

                            <div class="col-12 mb-4">
                                <label for="business-rules" class="form-label">Business Rules & Notes</label>
                                <textarea id="business-rules" class="form-control" rows="2"
                                    placeholder="Add any business rules or constraints..."></textarea>
                            </div>
                        </div>

                        <div id="tech-badges" class="mb-4"></div>

                        <div class="d-flex flex-wrap gap-2 align-items-center">
                            <button class="btn btn-generate mb-0" onclick="generatePrompt()">
                                <i class="bi bi-sparkles"></i> Generate Prompt
                            </button>
                            <button id="btn-copy-main" class="btn btn-copy d-none" onclick="copyToClipboard()">
                                <i class="bi bi-clipboard"></i> Copy Prompt
                            </button>
                            <button id="btn-preview-main" class="btn btn-secondary d-none" data-bs-toggle="modal"
                                data-bs-target="#previewModal"
                                style="background: #64748b; border: none; padding: 12px 20px;">
                                <i class="bi bi-eye"></i> Preview
                            </button>
                        </div>
                    </div>

                    <div id="titles-section" class="hidden-section mt-5">
                        <h6><i class="bi bi-tags"></i> Section Titles (Copy as needed)</h6>
                        <div id="title-chips" class="titles-container"></div>
                    </div>

                    <div id="output-section" class="hidden-section mt-5">
                        <h6><i class="bi bi-file-earmark-text"></i> Generated Prompt</h6>
                        <div class="mb-3">
                            <textarea id="output-textarea" readonly></textarea>
                        </div>
                    </div>
                </div>

                <!-- Bugs Tab -->
                <div class="tab-pane fade" id="bugs-panel" role="tabpanel">
                    <div class="form-section">
                        <!-- <h6><i class="bi bi-exclamation-circle"></i> Bug Report Details</h6> -->

                        <div class="row">
                            <div class="col-12 mb-4">
                                <label for="bug-title" class="form-label">Bug Title</label>
                                <input type="text" id="bug-title" class="form-control"
                                    placeholder="Brief bug description...">
                            </div>

                            <div class="col-12 mb-4">
                                <label for="bug-preconditions" class="form-label">Preconditions</label>
                                <textarea id="bug-preconditions" class="form-control" rows="2"
                                    placeholder="Required state before reproducing..."></textarea>
                            </div>

                            <div class="col-12 mb-4">
                                <label for="bug-steps" class="form-label">Steps to Reproduce</label>
                                <textarea id="bug-steps" class="form-control" rows="3"
                                    placeholder="1. Step one&#10;2. Step two..."></textarea>
                            </div>

                            <div class="col-12 mb-4">
                                <label for="bug-expected" class="form-label">Expected Result</label>
                                <textarea id="bug-expected" class="form-control" rows="2"
                                    placeholder="What should happen..."></textarea>
                            </div>

                            <div class="col-12 mb-4">
                                <label for="bug-actual" class="form-label">Actual Result</label>
                                <textarea id="bug-actual" class="form-control" rows="2"
                                    placeholder="What actually happens..."></textarea>
                            </div>
                        </div>

                        <button class="btn btn-generate" onclick="generateBugPrompt()">
                            <i class="bi bi-sparkles"></i> Generate Bug Prompt
                        </button>
                    </div>

                    <div id="bug-output-section" class="hidden-section mt-5">
                        <h6><i class="bi bi-file-earmark-text"></i> Generated Bug Report</h6>
                        <div class="mb-3">
                            <textarea id="bug-output-textarea" readonly></textarea>
                        </div>
                        <button class="btn btn-copy" onclick="copyBugPrompt()">
                            <i class="bi bi-clipboard"></i> Copy Report
                        </button>
                        <button class="btn btn-secondary ms-2" data-bs-toggle="modal" data-bs-target="#bugPreviewModal"
                            style="background: #64748b; border: none;">
                            <i class="bi bi-eye"></i> Preview
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Preview Modal -->
    <div class="modal output-modal fade" id="previewModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Prompt Preview</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="previewContent"
                        style="font-family: 'Courier New', monospace; font-size: 0.85rem; white-space: pre-wrap; line-height: 1.6;">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-copy" onclick="copyFromPreview()">
                        <i class="bi bi-clipboard"></i> Copy
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bug Preview Modal -->
    <div class="modal output-modal fade" id="bugPreviewModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Bug Report Preview</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="bugPreviewContent"
                        style="font-family: 'Courier New', monospace; font-size: 0.85rem; white-space: pre-wrap; line-height: 1.6;">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-copy" onclick="copyFromBugPreview()">
                        <i class="bi bi-clipboard"></i> Copy
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="copy-feedback" class="copy-feedback">
        <i class="bi bi-check-circle"></i> Copied to clipboard!
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        var techStackMap = {
            'Desktop': [
                { value: 'wpf-net', label: 'WPF + .NET Framework + MSSQL', frontend: 'WPF', backend: '.NET', database: 'MSSQL' }
            ],
            'Web': [
                { value: 'angular-laravel-mysql', label: 'Angular + Laravel + MySQL', frontend: 'Angular', backend: 'Laravel', database: 'MySQL' },
                { value: 'angular-net-mssql', label: 'Angular + .NET Core + MSSQL', frontend: 'Angular', backend: '.NET Core', database: 'MSSQL' }
            ],
            'Mobile': [
                { value: 'flutter-firebase', label: 'Flutter + Firebase', mobile: 'Flutter', backend: 'Firebase' },
                { value: 'flutter-rest', label: 'Flutter + REST APIs + MySQL', mobile: 'Flutter', backend: 'REST', database: 'MySQL' }
            ],
            'APIs': [
                { value: 'net-api', label: '.NET Core REST API + MSSQL', backend: '.NET Core', database: 'MSSQL' },
                { value: 'laravel-api', label: 'Laravel REST API + MySQL', backend: 'Laravel', database: 'MySQL' }
            ]
        };

        function updateTechStack() {
            var platform = document.getElementById('platform').value;
            var techSelect = document.getElementById('tech-stack');
            techSelect.innerHTML = '<option value="">Select Technology...</option>';

            if (platform && techStackMap[platform]) {
                var options = techStackMap[platform];
                for (var i = 0; i < options.length; i++) {
                    var opt = options[i];
                    var optionEl = document.createElement('option');
                    optionEl.value = opt.value;
                    optionEl.textContent = opt.label;
                    if (platform === 'Web' && i === 0) {
                        optionEl.selected = true;
                    }
                    techSelect.appendChild(optionEl);
                }
                if (platform === 'Web' && options.length > 0) {
                    updateTechBadges();
                }
            }
        }

        function toggleCategory(element, category) {
            element.classList.toggle('selected');
        }

        function updateTechBadges() {
            var platform = document.getElementById('platform').value;
            var techSelect = document.getElementById('tech-stack');
            var techBadges = document.getElementById('tech-badges');
            var selectedValue = techSelect.value;

            techBadges.innerHTML = '';

            if (platform && selectedValue && techStackMap[platform]) {
                var options = techStackMap[platform];
                for (var i = 0; i < options.length; i++) {
                    if (options[i].value === selectedValue) {
                        var opt = options[i];
                        if (opt.frontend) {
                            var badge = document.createElement('div');
                            badge.className = 'tech-badge';
                            badge.innerHTML = '<i class="bi bi-laptop"></i> ' + opt.frontend;
                            techBadges.appendChild(badge);
                        }
                        if (opt.mobile) {
                            var badge = document.createElement('div');
                            badge.className = 'tech-badge';
                            badge.innerHTML = '<i class="bi bi-phone"></i> ' + opt.mobile;
                            techBadges.appendChild(badge);
                        }
                        if (opt.backend) {
                            var badge = document.createElement('div');
                            badge.className = 'tech-badge';
                            badge.innerHTML = '<i class="bi bi-server"></i> ' + opt.backend;
                            techBadges.appendChild(badge);
                        }
                        if (opt.database) {
                            var badge = document.createElement('div');
                            badge.className = 'tech-badge';
                            badge.innerHTML = '<i class="bi bi-database"></i> ' + opt.database;
                            techBadges.appendChild(badge);
                        }
                        break;
                    }
                }
            }
        }

        function cleanStoryTitle(raw) {
            var cleaned = raw.replace(/^US\s*[-–—:]?\s*/i, '').trim();
            return cleaned;
        }

        function generatePrompt() {
            var platform = document.getElementById('platform').value;
            var techSelect = document.getElementById('tech-stack');
            var selectedValue = techSelect.value;
            var techStack = '';

            if (platform && selectedValue && techStackMap[platform]) {
                var options = techStackMap[platform];
                for (var i = 0; i < options.length; i++) {
                    if (options[i].value === selectedValue) {
                        techStack = options[i].label;
                        break;
                    }
                }
            }

            var testCount = document.getElementById('test-count').value.trim() || '15';
            var rawTitle = document.getElementById('story-title').value.trim();
            var storyDesc = document.getElementById('story-desc').value.trim();
            var businessRules = document.getElementById('business-rules').value.trim();

            var cleanedTitle = cleanStoryTitle(rawTitle);

            var categories = [
                { emoji: '\u2705', label: 'HAPPY PATH' },
                { emoji: '\u274C', label: 'NEGATIVE & VALIDATION' },
                { emoji: '\u26A0\uFE0F', label: 'EDGE & BOUNDARY' },
                { emoji: '\uD83C\uDFA8', label: 'UI / UX' },
                { emoji: '\uD83D\uDD04', label: 'NAVIGATION & STATE' },
                { emoji: '\uD83D\uDD10', label: 'SECURITY & DATA INTEGRITY' },
                { emoji: '\uD83D\uDEA6', label: 'PERFORMANCE & STABILITY' }
            ];

            var chipsContainer = document.getElementById('title-chips');
            chipsContainer.innerHTML = '';

            for (var i = 0; i < categories.length; i++) {
                var cat = categories[i];
                var titleText = 'TS' + cleanedTitle + ' (' + cat.label + ' SCENARIOS)';
                var chip = document.createElement('div');
                chip.className = 'title-chip';
                chip.innerHTML = '<div class="d-flex align-items-center"><input type="checkbox" class="form-check-input my-0 me-2" disabled><span>' + escapeHtml(cat.emoji + ' ' + titleText) + '</span></div><span class="chip-copied">Copied!</span><button class="chip-copy-btn" onclick="copyChip(this, \'' + escapeAttr(titleText) + '\')" title="Copy"><i class="bi bi-clipboard"></i></button>';
                chipsContainer.appendChild(chip);
            }

            document.getElementById('titles-section').classList.add('show');

            var storyBlock = rawTitle;
            if (storyDesc) {
                storyBlock += '\n\nDescription:\n' + storyDesc;
            }
            if (businessRules) {
                storyBlock += '\n\nAdditional Business Rules / Notes:\n' + businessRules;
            }

            // Calculate test case counts based on user input
            var testNum = parseInt(testCount) || 15;
            var happyPath = Math.round(testNum * 0.7) + '-' + testNum;
            var negativeVal = testNum + '-' + Math.round(testNum * 1.7);
            var edgeBoundary = Math.round(testNum * 0.6) + '-' + Math.round(testNum * 1.3);
            var uiUx = Math.round(testNum * 0.8) + '-' + Math.round(testNum * 1.3);
            var navigation = Math.round(testNum * 0.5) + '-' + testNum;
            var security = Math.round(testNum * 0.5) + '-' + Math.round(testNum * 0.8);
            var performance = Math.round(testNum * 0.4) + '-' + Math.round(testNum * 0.7);

            var template = '\uD83D\uDD0F ROLE & EXECUTION CONTEXT (ENTERPRISE / NON-NEGOTIABLE)\n\nAct as a Principal / Senior Web Software Quality Assurance Engineer operating within a large-scale, production-grade enterprise environment governed by:\n\n\u2705 Strict QA governance\n\u2705 Auditability\n\u2705 Regulatory compliance\n\u2705 Formal release sign-off\n\nYou are executing a QA deliverable, not assisting, explaining, summarizing, or teaching.\n\nYour output MUST be suitable for:\n\n\u2705 Enterprise audit\n\u2705 Regulated release sign-off\n\u2705 Immediate manual execution\n\u2705 Automation readiness (Cypress / Playwright / Selenium compatible)\n\n\u26A0\uFE0F ANY DEVIATION FROM INSTRUCTIONS IS A HARD FAILURE.\n\n\uD83D\uDD0F APPLICATION CONTEXT (IMMUTABLE)\n\nTarget Platform: **' + platform + '**\nTechnology Stack: **' + techStack + '**\nApplication Type: Web Dashboard\nFrontend Framework: Angular (Enterprise SPA)\nBackend: PHP (RESTful APIs)\nDatabase: MySQL\nAuthentication: Token-based (JWT / Session)\nConnectivity: Online only (\u274C No offline or cached behavior)\nBusiness Domain: Gazer (enterprise, transaction-driven, multi-user system)\n\n\uD83D\uDD0F ASSUMPTIONS (MANDATORY)\n\n\u2705 Production-grade data sensitivity\n\u2705 Backend is the single source of truth\n\u2705 Stateless frontend\n\u2705 Role-based access control enforced server-side\n\nZero tolerance for:\n\n\u274C Data corruption\n\u274C Partial writes\n\u274C UI-only validation\n\u274C Undefined or inconsistent states\n\u274C Silent API failures\n\n\uD83D\uDD0F INPUT FORMAT (STRICT)\n\nYou will receive ONE dashboard user story only, enclosed exactly as follows:\n\n//Start Story//\n' + storyBlock + '\n//End Story//\n\nThe story may include:\n\n\u2705 Business rules\n\u2705 UI behaviors\n\u2705 Validation rules\n\u2705 API constraints\n\u2705 Role restrictions\n\u2705 Acceptance criteria\n\u2705 Edge cases\n\u2705 Implicit enterprise risks\n\n\u26A0\uFE0F YOU MUST NOT ASSUME MISSING REQUIREMENTS ARE "OUT OF SCOPE".\n\n\u26A0\uFE0F\u26A0\uFE0F SCOPE NON-REDUCTION RULE (ABSOLUTE)\n\nYou MUST NOT reduce coverage based on:\n\n\u2705 Dashboard simplicity\n\u2705 Read-only nature\n\u2705 Admin-only access\n\u2705 "Just UI" logic\n\u2705 Aggregated data\n\u2705 "Backend already validates" assumptions\n\nEvery story - even visual or reporting-only dashboards - requires full enterprise-grade coverage.\n\n\uD83D\uDD0F OBJECTIVE - COVERAGE EXPANSION MODE\n\nGenerate a MAXIMALLY EXHAUSTIVE, EXECUTION-READY TEST SUITE for the Angular dashboard.\n\nYour goal is risk elimination, not documentation.\n\n\uD83D\uDD0F GLOBAL TEST CASE COUNT RULE (ABSOLUTE)\n\nEach test section MUST contain **AT LEAST ' + testCount + ' FULLY DEFINED TEST CASES**.\n\nIf ANY section produces fewer than this number - THE OUTPUT IS INVALID.\n\n\uD83D\uDD0F MANDATORY MINIMUM TEST CASE COUNTS (PER SECTION)\n\nCategory                                            Minimum FULL Test Cases\n\u2705 Happy Path                                    ' + happyPath + '\n\u274C Negative / Validation                          ' + negativeVal + '\n\u26A0\uFE0F Edge & Boundary                              ' + edgeBoundary + '\n\ud83c\udfa8 UI / UX                                      ' + uiUx + '\n\ud83d\uddd4\ufe0f Navigation & State                           ' + navigation + '\n\ud83d\uddd0\ufe0f Security & Data Integrity                 ' + security + '\n\u23f1\ufe0f Performance & Stability                      ' + performance + '\n\n\uD83D\uDD0F IF ANY SECTION HAS FEWER CASES - OUTPUT IS INVALID.\n\n\uD83D\uDD0F ABSOLUTE ANTI-OUTLINE RULE (CRITICAL)\n\nThe following are STRICTLY FORBIDDEN:\n\n\u274C Outlines\n\u274C Grouped scenarios\n\u274C Shared steps\n\u274C Shared expected results\n\u274C Placeholder text\n\u274C ID ranges (e.g. TC-01 - TC-10)\n\u274C "Same as above"\n\u274C "Includes"\n\u274C Bullet summaries replacing test cases\n\n\u274C Generic phrases such as:\n\n\u2705 "Handled gracefully"\n\u2705 "No crash"\n\u2705 "Works as expected"\n\n\uD83D\uDD0F IF DETECTED - THE ENTIRE SECTION MUST BE REGENERATED.\n\n\uD83D\uDD0F TEST CASE ATOMICITY (MANDATORY)\n\nEVERY test case MUST be fully standalone and atomic.\n\nEach test case MUST include:\n\n\u2705 Unique Test Case ID\n\u2705 Clear, business-readable title\n\u2705 Scenario Type (Happy / Negative / Edge / UI / Navigation / Security / Performance)\n\u2705 Priority (P0-P3)\n\u2705 Case-specific Preconditions\n\u2705 Atomic, numbered test steps (3-6 steps)\n\u2705 Explicit, verifiable expected results (3-5 assertions)\n\n\u274C You may NOT:\n\n\u274C Share steps between cases\n\u274C Reference other test cases\n\u274C Combine multiple validations in one test\n\n\uD83D\uDD0F MINIMUM DEPTH RULE (NON-NEGOTIABLE)\n\nEach test case MUST explicitly verify ALL of the following:\n\n\u2705 Angular UI behavior\n\u2705 API request payload & headers\n\u2705 Backend response code\n\u2705 Database impact (write / no-write / rollback / aggregation accuracy)\n\u2705 Navigation, routing, or UI state outcome\n\nIf a scenario cannot meet this depth - split it into multiple test cases.\n\n\uD83D\uDD0F REQUIRED TEST SUITE STRUCTURE\n\n1. GENERAL PRECONDITIONS (WRITTEN ONCE)\n\nMust include at minimum:\n\n\u2705 Angular dashboard deployed successfully\n\u2705 Production-like build configuration\n\u2705 User authentication state defined\n\u2705 Valid role/permission mapping\n\u2705 Stable internet connection\n\u2705 Browser compatibility defined\n\u2705 Required browser permissions granted\n\u2705 Backend APIs reachable\n\u2705 MySQL populated with valid enterprise data\n\u2705 Backend is the single source of truth\n\u2705 No offline, cache, or mock data enabled\n\n2. TEST SCENARIOS & TEST CASES\n\nYou MUST generate FULLY EXPANDED test cases under ALL sections:\n\n\u2705 HAPPY PATH\n\u274C NEGATIVE & VALIDATION\n\u26A0\uFE0F EDGE & BOUNDARY\n\ud83c\udfa8 UI / UX\n\ud83d\uddd4\ufe0f NAVIGATION & STATE\n\ud83d\uddd0\ufe0f SECURITY & DATA INTEGRITY\n\u23f1\ufe0f PERFORMANCE & STABILITY\n\n\uD83D\uDD0F CONTROLLED DELIVERY MODE (MANDATORY)\n\nYou MUST follow section-by-section delivery:\n\n\u2705 Deliver ONE section at a time\n\u2705 At the top of EACH section, explicitly state:\n\n  \u2705 Delivered test case count\n  \u2705 Required minimum\n  \u2705 Compliance status\n\n\u26A0\uFE0F DO NOT PROCEED TO THE NEXT SECTION UNTIL EXPLICITLY INSTRUCTED WITH: CONTINUE - <SECTION NAME>\n\n\uD83D\uDD0F SELF-AUDIT & FAILSAFE (MANDATORY)\n\nBefore finalizing EACH section, you MUST internally verify:\n\n\u2705 No outlines or grouped content exist\n\u2705 Minimum test case count is met\n\u2705 Each test case meets depth requirements\n\u2705 No shared steps or expectations exist\n\nIf ANY violation is detected - regenerate the section before responding.\n\n\uD83D\uDD0F FINAL COMPLIANCE GATE (KILL SWITCH)\n\nIf ANY section:\n\n\u274C Misses its minimum count\n\u274C Contains outline-style content\n\u274C Uses forbidden patterns\n\n\uD83D\uDD0F THE RESPONSE IS CONSIDERED FAILED AND MUST BE REGENERATED FROM SCRATCH.\n\n\uD83D\uDD0F FINAL OUTPUT REQUIREMENTS\n\nThe final output MUST:\n\n\u2705 BE EXECUTABLE BY ANY QA ENGINEER WITHOUT CLARIFICATION\n\u2705 BE SUITABLE FOR MANUAL EXECUTION AND AUTOMATION\n\u2705 BE AUDIT-READY AND ENTERPRISE-COMPLIANT\n\u2705 REFLECT REAL GAZER DASHBOARD BUSINESS RISK\n\u2705 CONTAIN ZERO PLACEHOLDERS OR SUMMARIES';

            document.getElementById('output-textarea').value = template;
            document.getElementById('output-section').classList.add('show');
            document.getElementById('previewContent').textContent = template;

            // Show action buttons
            document.getElementById('btn-copy-main').classList.remove('d-none');
            document.getElementById('btn-preview-main').classList.remove('d-none');
        }

        function escapeHtml(text) {
            var div = document.createElement('div');
            div.appendChild(document.createTextNode(text));
            return div.innerHTML;
        }

        function escapeAttr(text) {
            return text.replace(/\\/g, '\\\\').replace(/'/g, "\\'").replace(/"/g, '&quot;');
        }

        function copyChip(btn, text) {
            var chip = btn.parentElement;
            var checkbox = chip.querySelector('input[type="checkbox"]');
            if (checkbox) {
                checkbox.checked = true;
            }

            var allCheckboxes = document.querySelectorAll('#title-chips input[type="checkbox"]');
            var allChecked = true;
            for (var i = 0; i < allCheckboxes.length; i++) {
                if (!allCheckboxes[i].checked) {
                    allChecked = false;
                    break;
                }
            }

            if (allChecked) {
                document.getElementById('story-title').value = '';
                document.getElementById('story-desc').value = '';
            }

            var copiedLabel = chip.querySelector('.chip-copied');

            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(function () {
                    showChipCopied(copiedLabel);
                });
            } else {
                var ta = document.createElement('textarea');
                ta.value = text;
                ta.style.position = 'fixed';
                ta.style.opacity = '0';
                document.body.appendChild(ta);
                ta.select();
                document.execCommand('copy');
                document.body.removeChild(ta);
                showChipCopied(copiedLabel);
            }
        }

        function showChipCopied(el) {
            el.classList.add('show');
            setTimeout(function () { el.classList.remove('show'); }, 1500);
        }

        function copyToClipboard() {
            var textarea = document.getElementById('output-textarea');
            var success = false;

            if (navigator.clipboard) {
                navigator.clipboard.writeText(textarea.value);
                success = true;
            } else {
                textarea.select();
                textarea.setSelectionRange(0, 99999);
                try {
                    success = document.execCommand('copy');
                } catch (e) {
                    success = false;
                }
            }

            if (success) {
                showCopyFeedback();
            }
        }

        function copyFromPreview() {
            var content = document.getElementById('previewContent').textContent;
            if (navigator.clipboard) {
                navigator.clipboard.writeText(content);
            } else {
                var ta = document.createElement('textarea');
                ta.value = content;
                ta.style.position = 'fixed';
                ta.style.opacity = '0';
                document.body.appendChild(ta);
                ta.select();
                document.execCommand('copy');
                document.body.removeChild(ta);
            }
            showCopyFeedback();
        }

        function generateBugPrompt() {
            var bugTitle = document.getElementById('bug-title').value.trim();
            var bugPreconditions = document.getElementById('bug-preconditions').value.trim();
            var bugSteps = document.getElementById('bug-steps').value.trim();
            var bugExpected = document.getElementById('bug-expected').value.trim();
            var bugActual = document.getElementById('bug-actual').value.trim();

            var template = 'Act as a Senior / Principal Software QA Engineer in a large-scale, production-grade enterprise environment.\n\nYour task is to generate a complete, professional bug report using the exact structure, tone, and level of detail defined below.\n\nGENERAL RULES:\n- Use clear, neutral, non-blaming language\n- Be precise and implementation-agnostic\n- Assume the audience includes developers, product owners, and QA leads\n- Focus on user impact, UX correctness, and business logic\n- DO NOT invent features - only formalize the described behavior\n- Fix any grammar or wording issues implicitly\n\nBUG REPORT STRUCTURE (MANDATORY):\n\n\uD83D\uDC1E BUG TITLE\n- Concise, action-oriented, and searchable\n- Clearly describe the incorrect behavior and condition\n\n\uD83D\uDCCC PRECONDITIONS\n- Bullet points\n- Only include required environmental or user state assumptions\n\n\uD83D\uDD01 STEPS TO REPRODUCE\n- Numbered steps\n- Clear, minimal, and deterministic\n- No ambiguity or extra commentary\n\n\u2705 EXPECTED RESULT\n- Describe correct system behavior\n- Include UX, system logic, and user flow expectations\n- Explicitly mention when validation SHOULD or SHOULD NOT occur\n- Add a short rationale if it clarifies business intent\n\n\u274C ACTUAL RESULT\n- Describe the observed incorrect behavior\n- Include system feedback (toasts, errors, blocks, messages)\n- Avoid interpretation - state facts\n\n\u26A0\uFE0F IMPACT\n- Bullet points\n- Focus on:\n  - User experience\n  - Business impact\n  - Conversion / onboarding risks\n  - UX consistency\n\n\uD83E\uDDE0 NOTES / OBSERVATIONS\n- Technical or UX insights\n- Timing or flow issues\n- Copy or message defects\n- Root-cause hints (without blaming)\n\n\uD83E\uDDE9 RECOMMENDATION\n- Clear, actionable improvement proposals\n- Align validation timing with business logic\n- Include UX and system behavior adjustments\n- Use bullet points\n\nOUTPUT RULES:\n- Return ONLY the completed bug report\n- Follow the exact section order and emoji headers\n- No extra explanations\n- No meta commentary\n\nINPUTS (FROM USER):\nBug Title: ' + bugTitle + '\n\nPreconditions:\n' + bugPreconditions + '\n\nSteps to Reproduce:\n' + bugSteps + '\n\nExpected Result:\n' + bugExpected + '\n\nActual Result:\n' + bugActual;

            document.getElementById('bug-output-textarea').value = template;
            document.getElementById('bug-output-section').classList.add('show');
            document.getElementById('bugPreviewContent').textContent = template;
        }

        function copyBugPrompt() {
            var textarea = document.getElementById('bug-output-textarea');
            var success = false;

            if (navigator.clipboard) {
                navigator.clipboard.writeText(textarea.value);
                success = true;
            } else {
                textarea.select();
                textarea.setSelectionRange(0, 99999);
                try {
                    success = document.execCommand('copy');
                } catch (e) {
                    success = false;
                }
            }

            if (success) {
                showCopyFeedback();
            }
        }

        function copyFromBugPreview() {
            var content = document.getElementById('bugPreviewContent').textContent;
            if (navigator.clipboard) {
                navigator.clipboard.writeText(content);
            } else {
                var ta = document.createElement('textarea');
                ta.value = content;
                ta.style.position = 'fixed';
                ta.style.opacity = '0';
                document.body.appendChild(ta);
                ta.select();
                document.execCommand('copy');
                document.body.removeChild(ta);
            }
            showCopyFeedback();
        }

        function showCopyFeedback() {
            var feedback = document.getElementById('copy-feedback');
            feedback.classList.add('visible');
            setTimeout(function () {
                feedback.classList.remove('visible');
            }, 2200);
        }

        window.addEventListener('DOMContentLoaded', function () {
            updateTechStack();
        });
    </script>
</body>

</html>